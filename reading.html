<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>毛泽东选集 - 全文在线阅读 | Red Wisdom</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="毛泽东选集全5卷228篇在线阅读，包含《矛盾论》《实践论》《论持久战》等经典著作，原文无删减。">
    <meta name="keywords" content="毛泽东选集,毛选,矛盾论,实践论,论持久战,在线阅读">
    <meta name="author" content="Red Wisdom">

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="毛泽东选集 - 全文在线阅读">
    <meta property="og:description" content="毛泽东选集全5卷228篇在线阅读，经典著作原文无删减。">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/favicon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'warm-rice': '#F7F4ED',
                        'china-red': '#BC2D22',
                        'ink-black': '#2B2B2B',
                        'dark-beige': '#D6C6B0',
                        'sidebar-bg': '#1a1a1a',
                        'sidebar-hover': '#2d2d2d',
                    },
                    fontFamily: {
                        'mao': ['"Ma Shan Zheng"', 'cursive'],
                        'serif': ['"Noto Serif SC"', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #BC2D22;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #8B1F19;
        }

        /* Sidebar styles */
        .sidebar {
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        /* Volume section */
        .volume-title {
            cursor: pointer;
            user-select: none;
        }

        .volume-title:hover {
            background-color: rgba(188, 45, 34, 0.1);
        }

        .volume-articles {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .volume-articles.expanded {
            max-height: 2000px;
        }

        /* Article item */
        .article-item {
            padding: 8px 16px 8px 24px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #aaa;
            border-left: 2px solid transparent;
        }

        .article-item:hover {
            background-color: #2d2d2d;
            color: #fff;
        }

        .article-item.active {
            border-left-color: #BC2D22;
            background-color: rgba(188, 45, 34, 0.2);
            color: #fff;
        }

        /* Article content styling */
        .article-content h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #BC2D22;
            margin-bottom: 0.5rem;
            font-family: "Noto Serif SC", serif;
        }

        .article-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2B2B2B;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .article-content p {
            line-height: 2;
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        .article-content blockquote {
            border-left: 4px solid #BC2D22;
            padding-left: 1rem;
            margin: 1.5rem 0;
            color: #555;
            background: rgba(188, 45, 34, 0.05);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .article-content hr {
            margin: 2rem 0;
            border-color: #D6C6B0;
        }

        /* Mobile menu button */
        .menu-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 100;
            background: #BC2D22;
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            display: none;
        }

        @media (max-width: 768px) {
            .menu-btn {
                display: block;
            }

            .sidebar {
                position: fixed;
                z-index: 50;
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #BC2D22;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-warm-rice h-screen flex overflow-hidden">
    <!-- Mobile Menu Button -->
    <button class="menu-btn" id="menuBtn" onclick="toggleSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="sidebar w-80 bg-sidebar-bg text-white h-screen overflow-y-auto shrink-0 md:relative fixed">
        <!-- Header -->
        <div class="sticky top-0 bg-sidebar-bg z-10 p-4 border-b border-gray-700">
            <a href="index.html" class="flex items-center gap-2 text-china-red hover:opacity-80 transition mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                <span class="font-mao text-lg">返回首页</span>
            </a>
            <h1 class="font-mao text-2xl text-china-red">毛泽东选集</h1>
            <p class="text-gray-400 text-sm mt-1">共 5 卷 · 228 篇</p>
        </div>

        <!-- Volume List -->
        <nav id="volumeList" class="py-2">
            <!-- Will be populated by JavaScript -->
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 min-h-screen overflow-y-auto">
        <!-- Article Content -->
        <article id="articleContent"
            class="article-content max-w-4xl mx-auto px-6 md:px-12 py-8 font-serif text-ink-black">
            <!-- Welcome Message -->
            <div id="welcomeMessage" class="text-center py-20">
                <h1 class="font-mao text-4xl text-china-red mb-4">毛泽东选集</h1>
                <p class="text-gray-600 text-lg mb-8">请从左侧目录选择一篇文章开始阅读</p>
                <div class="flex justify-center gap-4 flex-wrap">
                    <button onclick="loadArticle('016-实践论.md')"
                        class="px-4 py-2 bg-china-red text-white rounded-lg hover:bg-red-800 transition">
                        实践论
                    </button>
                    <button onclick="loadArticle('017-矛盾论.md')"
                        class="px-4 py-2 bg-china-red text-white rounded-lg hover:bg-red-800 transition">
                        矛盾论
                    </button>
                    <button onclick="loadArticle('026-论持久战.md')"
                        class="px-4 py-2 bg-china-red text-white rounded-lg hover:bg-red-800 transition">
                        论持久战
                    </button>
                    <button onclick="loadArticle('076-为人民服务.md')"
                        class="px-4 py-2 bg-china-red text-white rounded-lg hover:bg-red-800 transition">
                        为人民服务
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden flex justify-center items-center py-20">
                <div class="spinner"></div>
            </div>

            <!-- Article Body -->
            <div id="articleBody" class="hidden"></div>
        </article>

        <!-- Navigation Footer -->
        <div id="navFooter" class="hidden max-w-4xl mx-auto px-6 md:px-12 pb-12">
            <div class="flex justify-between items-center border-t border-dark-beige pt-6">
                <button id="prevBtn" onclick="loadPrevArticle()"
                    class="flex items-center gap-2 text-china-red hover:opacity-70 transition disabled:opacity-30">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                    <span id="prevTitle">上一篇</span>
                </button>
                <button id="nextBtn" onclick="loadNextArticle()"
                    class="flex items-center gap-2 text-china-red hover:opacity-70 transition disabled:opacity-30">
                    <span id="nextTitle">下一篇</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7" />
                    </svg>
                </button>
            </div>
        </div>
    </main>

    <script>
        let catalog = null;
        let allArticles = [];
        let currentArticleIndex = -1;

        // Load catalog data
        async function loadCatalog() {
            try {
                const response = await fetch('data/catalog.json');
                catalog = await response.json();

                // Flatten all articles for navigation
                Object.values(catalog.volumes).forEach(articles => {
                    allArticles = allArticles.concat(articles);
                });

                renderVolumeList();

                // Check URL hash for direct article link
                if (window.location.hash) {
                    const filename = decodeURIComponent(window.location.hash.slice(1));
                    loadArticle(filename);
                }
            } catch (error) {
                console.error('Failed to load catalog:', error);
            }
        }

        // Render volume list in sidebar
        function renderVolumeList() {
            const container = document.getElementById('volumeList');
            let html = '';

            Object.entries(catalog.volumes).forEach(([volumeName, articles], idx) => {
                html += `
                    <div class="volume-section">
                        <div class="volume-title flex items-center gap-2 px-4 py-3 text-gray-200 font-medium" onclick="toggleVolume(${idx})">
                            <svg id="arrow-${idx}" class="transform transition-transform" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18l6-6-6-6"/>
                            </svg>
                            <span>${volumeName}</span>
                            <span class="text-gray-500 text-xs ml-auto">${articles.length}篇</span>
                        </div>
                        <div id="volume-${idx}" class="volume-articles">
                            ${articles.map(article => `
                                <div class="article-item" data-filename="${article.filename}" onclick="loadArticle('${article.filename}')">
                                    ${article.title}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Toggle volume expansion
        function toggleVolume(idx) {
            const volumeEl = document.getElementById(`volume-${idx}`);
            const arrowEl = document.getElementById(`arrow-${idx}`);

            volumeEl.classList.toggle('expanded');
            arrowEl.style.transform = volumeEl.classList.contains('expanded') ? 'rotate(90deg)' : '';
        }

        // Load article content
        async function loadArticle(filename) {
            const welcomeEl = document.getElementById('welcomeMessage');
            const loadingEl = document.getElementById('loadingState');
            const bodyEl = document.getElementById('articleBody');
            const navEl = document.getElementById('navFooter');

            // Show loading
            welcomeEl.classList.add('hidden');
            bodyEl.classList.add('hidden');
            navEl.classList.add('hidden');
            loadingEl.classList.remove('hidden');

            try {
                const response = await fetch(`data/articles/${encodeURIComponent(filename)}`);
                if (!response.ok) throw new Error('Article not found');

                const markdown = await response.text();
                const html = marked.parse(markdown);

                bodyEl.innerHTML = html;
                bodyEl.classList.remove('hidden');
                loadingEl.classList.add('hidden');
                navEl.classList.remove('hidden');

                // Update URL hash
                window.location.hash = filename;

                // Update active state in sidebar
                document.querySelectorAll('.article-item').forEach(el => {
                    el.classList.toggle('active', el.dataset.filename === filename);
                });

                // Find current index for navigation
                currentArticleIndex = allArticles.findIndex(a => a.filename === filename);
                updateNavButtons();

                // Expand the containing volume
                expandContainingVolume(filename);

                // Scroll to top
                document.querySelector('main').scrollTo(0, 0);

                // Close sidebar on mobile
                if (window.innerWidth < 768) {
                    document.getElementById('sidebar').classList.add('collapsed');
                }

            } catch (error) {
                console.error('Failed to load article:', error);
                bodyEl.innerHTML = '<p class="text-center text-red-600 py-20">加载失败，请重试</p>';
                bodyEl.classList.remove('hidden');
                loadingEl.classList.add('hidden');
            }
        }

        // Expand the volume containing the current article
        function expandContainingVolume(filename) {
            let volumeIdx = 0;
            for (const [volumeName, articles] of Object.entries(catalog.volumes)) {
                if (articles.some(a => a.filename === filename)) {
                    const volumeEl = document.getElementById(`volume-${volumeIdx}`);
                    const arrowEl = document.getElementById(`arrow-${volumeIdx}`);
                    volumeEl.classList.add('expanded');
                    arrowEl.style.transform = 'rotate(90deg)';
                    break;
                }
                volumeIdx++;
            }
        }

        // Update navigation buttons
        function updateNavButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const prevTitle = document.getElementById('prevTitle');
            const nextTitle = document.getElementById('nextTitle');

            if (currentArticleIndex > 0) {
                prevBtn.disabled = false;
                prevBtn.classList.remove('opacity-30');
                prevTitle.textContent = allArticles[currentArticleIndex - 1].title;
            } else {
                prevBtn.disabled = true;
                prevBtn.classList.add('opacity-30');
                prevTitle.textContent = '已是第一篇';
            }

            if (currentArticleIndex < allArticles.length - 1) {
                nextBtn.disabled = false;
                nextBtn.classList.remove('opacity-30');
                nextTitle.textContent = allArticles[currentArticleIndex + 1].title;
            } else {
                nextBtn.disabled = true;
                nextBtn.classList.add('opacity-30');
                nextTitle.textContent = '已是最后一篇';
            }
        }

        function loadPrevArticle() {
            if (currentArticleIndex > 0) {
                loadArticle(allArticles[currentArticleIndex - 1].filename);
            }
        }

        function loadNextArticle() {
            if (currentArticleIndex < allArticles.length - 1) {
                loadArticle(allArticles[currentArticleIndex + 1].filename);
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        // Initialize
        loadCatalog();
    </script>
</body>

</html>